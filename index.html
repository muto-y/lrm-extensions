<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="ROBOTS" content="NOINDEX, NOFOLLOW" />
		<title>lrm-extensions by wwwouaiebe</title>
		<meta name="author" content="Christian Guyette" />
		<link rel="stylesheet" href="leaflet.css" />
		<link rel="stylesheet" href="leaflet-routing-machine.css" />
		<link rel="stylesheet" href="lrm-extensions.css" />
		<link rel="stylesheet" href="index.css" media="screen"/>
	</head>
	<body>
		<header>
			<nav id="Menu">
				<div id="Help" class="MenuItem">
					<a href="https://github.com/wwwouaiebe/lrm-extensions/tree/gh-pages" target="_blank">Help</a>
				</div>
				<div id="View" class="MenuItem">
					<a href="https://github.com/wwwouaiebe/lrm-extensions" target="_blank">View On GitHub</a>
				</div>
				<div id="Download" class="MenuItem">
					Download:
				</div>
				<div class="MenuItem">
					<a href="https://github.com/wwwouaiebe/lrm-extensions/zipball/master">ZIP</a>
				</div>
				<div class="MenuItem">
					<a href="https://github.com/wwwouaiebe/lrm-extensions/tarball/master">TAR</a>
				</div>
			</nav>
		</header>
		<div id="Map">
		</div>
		<div id="Text">
			<p id="Warning"> 
				You must have at least one access token to a route provider to see this demo correctly.
				Please complete with your access token(s) and then push on the button to save the access tokens in the browser storage and reload the page:
			</p>
			<form id="options">
				<p>GraphHopper access token:</p><p><input id="graphHopperKey" type="text"></input></p>
				<p>Mapzen access token:</p><p><input id="mapzenKey" type="text"></input></p>
				<p>Mapbox access token:</p><p><input id="mapboxKey" type="text"></input></p>
				<p><input id="saveKeys" type="button" value="Save access tokens and reload page"></input></p>
			</form>
			<p>Visit <a href="https://graphhopper.com/dashboard/#/register" target="_blank">GraphHopper</a>, <a href="https://mapzen.com/developers/sign_in" target="_blank">Mapzen</a> and/or <a href="https://www.mapbox.com/studio/signup/?plan=starter" target="_blank">Mapbox</a>, to obtain an access token.
		</div>
		<script src="leaflet.js"></script>
		<script src="leaflet-routing-machine.min.js"></script>
		<script src="lrm-extensions.min.js"></script>
		<script>
			(function( ) 
			{
				'use strict';
				var storageAvailable = function ( ) {
					try {
						var	x = '__storage_test__';
						localStorage.setItem ( x, x );
						localStorage.removeItem ( x );
						return true;
					}
					catch ( e ) {
						return false;
					}				
				};
				var graphHopperKey = localStorage.getItem ( 'lrm-extensions.graphHopperKey' );
				var mapzenKey = localStorage.getItem ( 'lrm-extensions.mapzenKey' );
				var mapboxKey = localStorage.getItem ( 'lrm-extensions.mapboxKey' );
				var providerKeys  = {};
				providerKeys.GraphHopper = '';
				if ( graphHopperKey ) {
					providerKeys.GraphHopper =  graphHopperKey;
					document.getElementById ( "graphHopperKey" ).value = graphHopperKey;
				}
				if ( mapzenKey ) {
					providerKeys.Mapzen =  mapzenKey;
					document.getElementById ( "mapzenKey" ).value = mapzenKey;
				}
				if ( mapboxKey ) {
					providerKeys.Mapbox =  mapboxKey;
					document.getElementById ( "mapboxKey" ).value = mapboxKey;
				}
				var Map = L.map ( 'Map' ).setView( [ 50.52079,5.54741 ], 13 );
				L.tileLayer ( 'http://{s}.tile.osm.org/{z}/{x}/{y}.png', { attribution: '&copy; <a href="http://www.openstreetmap.org/copyright" title="Contributeurs de OpenStreetMap">Contributeurs de OpenStreetMap</a> | &copy; <a href="http://www.ouaie.be/" title="http://www.ouaie.be/">Christian Guyette</a>' } ).addTo ( Map );
				var Routing = L.Routing.extensions( {
					waypoints: [ L.latLng ( 50.50879,5.49313 ), L.latLng ( 50.53038,5.57248 ) ],
					providerKeys : providerKeys,
					showAlternatives: true,
					waypointMode : 'snap',
					fitSelectedRoutes : false,
					collapsible : true,
					altLineOptions : 
						{
							styles : [{color: 'black', opacity: 0.15, weight: 9}, {color: 'white', opacity: 0.8, weight: 6}, {color: 'blue', opacity: 1, weight: 2}],
							addWaypoints : true ,
							missingRouteStyles : [{color: 'black', opacity: 0.15, weight: 7},{color: 'white', opacity: 0.6, weight: 4},{color: 'gray', opacity: 0.8, weight: 2, dashArray: '7,12'}]
						},
					lineOptions : 
						{
							styles : [{color: 'black', opacity: 0.15, weight: 9}, {color: 'white', opacity: 0.8, weight: 6}, {color: 'red', opacity: 1, weight: 4}],
							addWaypoints : true ,
							missingRouteStyles : [{color: 'black', opacity: 0.15, weight: 7},{color: 'white', opacity: 0.6, weight: 4},{color: 'gray', opacity: 0.8, weight: 2, dashArray: '7,12'}]
						},
					dragStyles : [{color: 'black', opacity: 0.15, weight: 7}, {color: 'white', opacity: 0.8, weight: 6}, {color: 'green', opacity: 1, weight: 2, dashArray: '7,12'}],
				} ).addTo( Map );
				L.Routing.errorControl( Routing ).addTo( Map );
				
				var saveKeys = function ( event ) {
					if ( ! storageAvailable ( ) )
					{
						return;
					}
					console.log ( "saveKeys 3" );
					localStorage.setItem ( 'lrm-extensions.graphHopperKey', document.getElementById ( "graphHopperKey" ).value );
					localStorage.setItem ( 'lrm-extensions.mapzenKey', document.getElementById ( "mapzenKey" ).value );
					localStorage.setItem ( 'lrm-extensions.mapboxKey', document.getElementById ( "mapboxKey" ).value );
					window.location.reload ( );
					
				};
				document.getElementById ( "saveKeys" ).addEventListener ( 
					'click', 
					saveKeys
				);
			} ());		
		</script>
	</body>
</html>
